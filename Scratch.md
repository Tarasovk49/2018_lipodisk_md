# This is scratch document for algorithms, plots, logs and everything else that can be useful.
### Prepare lipodisk with sensory rhodopsin in DMPC.
1. Prepare topology for DMPC. Cut down the DPPC by two atoms on each chain - C215, C216, C315, C316. Delete all bonded interactions from *lipids.rtp*.
<p align="center">
  <img width="600" height="350" src="images/DMPC.png">
</p>
2. Prepare topology for Retinal-lysine (residue REK).
* Upload retinal without C15 linkage to lysine to [TTPMKTOP](http://erg.biophys.msu.ru/erg/tpp/). Manually change some atom names according to alkane and alkene atomname specifications.
* Manually modify *ffbonded.itp*. Add specific angles and dihedrals which are absent in normal opls-aa forcefield. The parameters for such angles and dihedrals were chosen corresponding to alkane and alkene topology specifications. The lines added can be seen below.

**Angles**
```
; Retinal+lysine
  C=      C     NC      1   116.000    585.760   ; wlj
  CT     NC      C      1   118.600    585.760   ; 
  C=     C=     C=      1   124.000    585.760   ; wlj
  C=     CT     CT      1   116.000    585.760   ; wlj
  C=     C=      C      1   124.000    585.760   ; wlj
```
**Dihedrals**
```
; Retinal+lysine
  HC     CT     CT     NC      3      5.77183  -2.67148   0.95814  -4.05848   0.00000   0.00000 ; 
  CT     CT     NC     C       3      3.80117  -6.95172  -1.01671   4.16726   0.00000   0.00000 ; 
  HC     CT     NC     C       3      3.80117  -6.95172  -1.01671   4.16726   0.00000   0.00000 ; JUST COPIED FROM C-C-N-C!
  CT     NC      C     C=      3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; imine 
  CT     NC      C     HC      3      3.80117  -6.95172  -1.01671   4.16726   0.00000   0.00000 ; JUST COPIED FROM C-C-N-C!
  CT     CM     C=     C=      3      2.92880  -1.46440   0.20920  -1.67360   0.00000   0.00000 ; hydrocarbon all-atom
  C=     CM     CT     HC      3      0.62760   1.88280   0.00000  -2.51040   0.00000   0.00000 ;
  CM     C=     C=     C=      3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  CT     C=     C=     C=      3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  CM     C=     CT     CT      3      2.92880  -1.46440   0.20920  -1.67360   0.00000   0.00000 ; hydrocarbon all-atom
  C=     C=     CT     CT      3      2.92880  -1.46440   0.20920  -1.67360   0.00000   0.00000 ; hydrocarbon all-atom
  C=     C=     C=     HC      3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  C=     C=     C=     C=      3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  C=     CT     CT     HC      3      0.62760   1.88280   0.00000  -2.51040   0.00000   0.00000 ;
  C=     CT     CT     CT      3      2.92880  -1.46440   0.20920  -1.67360   0.00000   0.00000 ; hydrocarbon all-atom
  C=     C=     C=     C       3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  CT     C=     C=     C       3     58.57600   0.00000 -58.57600   0.00000   0.00000   0.00000 ; alkene
  C=     C=     CT     HC      3      0.62760   1.88280   0.00000  -2.51040   0.00000   0.00000 ;
  C=     C=     C      NC      3      5.77183  -2.67148   0.95814  -4.05848   0.00000   0.00000 ; 
  C=     C=     C      HC      3      0.62760   1.88280   0.00000  -2.51040   0.00000   0.00000 ;
  HC     C=     C      HC      3      0.62760   1.88280   0.00000  -2.51040   0.00000   0.00000 ; hydrocarbon *new* 11/99
  HC     C=     C      NC      3      5.77183  -2.67148   0.95814  -4.05848   0.00000   0.00000 ; 
```
3. Generate polymer molecules without double Maleic acid monomers along. The algorithm iterates until the length is less than desired. First M (maleic acid) or S (styrol) is selected as the first monomer with frequencies *pm0* and *ps0*. Then in case S was selected M or S is selected once more and so on until M is selected. In this case on next iteration SM or S is selected with frequencies *psm* and *ps*. In case SM was selected SM or S is selected again and so on until S is selected. Then the algorithm comes to the selection of M and S again. Selections are shown in the picture with ovals. *pm0* and *ps0* - are the desired frequencies of Maleic acid and Styrol monomers in polymer molecules. *psm* can be calculated from *pm0 = psm/(ps + 2\*psm)* which is the condition of frequency of maleic acid being inserted with the second oval to represent the desired value of *pm0*. Thus *psm = pm0/(1 - pm0)* and *ps = 1 - psm*. The lengrh of polymer generated by algorithm is either equal or greater by one monomer than the desired. Probability of polymer to have the length one greater is close to *2\*psm/3*, so the initial distribution of length of polymer molecules must have the mean *2\*psm/3* less the desired to achieve the desired value finally.
<p align="center">
  <img width="1000" height="350" src="images/Nodoublemal algorithm.png">
</p>
